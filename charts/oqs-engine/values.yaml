replicaCount: 1

#fullnameOverride: oqsengine

image:
  repository: registry.cn-hangzhou.aliyuncs.com/xf-bm-xplat-msg/xplat-meta-oqsengine-boot
  # default .Chart.Version
  #tag: "2019.11.26-160902-develop"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port:
    http: 8086
    grpc: 8081

ingress:
  enabled: false
  annotations: {}
  # kubernetes.io/ingress.class: nginx
  # kubernetes.io/tls-acme: "true"
  path: /
  hosts:
    - chart-example.local
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

resources:
  limits:
    cpu: 4000m
    memory: 6144Mi
  requests:
    cpu: 4000m
    memory: 6144Mi

nodeSelector: {}

tolerations: []

affinity: {}

annotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8086"
  prometheus.io/path: "/actuator/prometheus"

# 推荐-Xmx大小为limit的60%.
jvm:
  - -server
  - -Xms4096M
  - -Xmx4096M
  - -XX:+UseG1GC
  - -XX:MaxGCPauseMillis=50
  - -XX:ParallelGCThreads=4
  - -XX:+UseCompressedOops
  - -XX:+UseStringDeduplication
  - -XX:ReservedCodeCacheSize=256m
  - -XX:+UseStringDeduplication

jmx:
  enabled: false
  port: 1099
  hostname: "127.0.0.1"

logger:
  level: INFO

cdc:
  connect:
    type: single
    host: 127.0.0.1
    port: 11111
    username: root
    password: root
    subscribeFilter: .*\.oqsbigentity.*
    batchSize: 2048
    destination: oqsengine
  consumer:
    checkCommitReady: true
    skipCommitId: -1

meta:
  grpc:
    type: client
    host: localhost
    port: 8082
    seconds:
      # 心跳超时
      heartbeatTimeout: 30
      # 重试间隔
      delaytaskTimeout: 30
      # 心跳间隔
      keepAliveDuration: 5
      # 指标监控
      monitorDuration: 1
      # 重连间隔
      reconnectDuration: 5
  # 启动导入本地meta信息(属地不连接metadata使用)
  load:
    path: "-"

query:
  # 查询的最大匹配数量.
  maxVisibleTotalCount: 10000
  join:
    # join查询时的驱动表匹配上限.
    maxJoinEntityNumber: 2
    # join查询时的驱动表的数量最大上限,此值不能大于 maxVisibleTotalCount.
    maxJoinDriverLineNumber: 1000
changelog:
  enabled: false
metadata:
  enhanced: false
storage:
  tokenizer:
    segmentation:
      lexicon:
        # 字典URL
        url: "-"
  debug:
    remote:
      enabled: false
    showsql: false
  # Maximum amount of visible data.
  maxVisibleNumber: 10000
  threadPool:
    # Setting 0 means using CPU cores +1 threads. The queue length defaults to 500.
    io:
      # Response service thread pool.
      worker: 64
      queue: 1000
    task:
      # Backend task thread pool.
      worker: 64
      queue: 1000
  transaction:
    # The transaction is valid for a period of time that will be rollback.
    timeoutMs: 3000
  timeoutMs:
    query: 3000
  kv:
    name: "kv"
  master:
    name: "oqsbigentity"
    shard:
      table:
        # Whether sub-tables are needed and the number of sub-tables.
        enabled: false
        size: 1
  index:
    search:
      name: "oqsindex"
    write:
      name: "oqsindex"
      shard:
        enabled: false
        size: 1
  devOps:
    cdc:
      errors:
        name: "cdcerrors"
    maxQueryTimeMs: 3000
    task:
      split: 10
      max:
        queue:
          size: 2000
      execution:
        timeout: 300000
      cache:
        expire: 30
        maxsize: 500
      page:
        size: 1000

redis:
  uri: "redis://localhost:6379"
  maxReqQueue: 2147483647

sync:
  ignoreCDCStatusCheck: false
  # The heartbeat delay of data synchronization. Milliseconds.
  allowMaxLiveTimeMs: 3000
  # Acceptable number of unsynchronized commit Numbers.
  allowMaxUnSyncCommitIdSize: 1000

discover:
  sdk:
    enable: false
    connection:
      host: "ultraman-devops-service-test.n01103-oqs-cdc"
      port: "8916"
    time:
      heartbeat:
        expired: 60000
        duration: 5000
    agent:
      serviceId: ${HOSTNAME}.${instance.id}
      serviceGroup: ${HOSTNAME}
      serviceName: "oqs-engine"
    threadPool:
      task: 5
      queue: 100

# datasource json config
# Multiple data sources are separated by Numbers.
# The HikariCP connection pool implementation is used, see configuration parameters.
# see https://github.com/brettwooldridge/HikariCP#configuration-knobs-baby
# Note that mysql default connection idle time is 8 hours and manticore is 15 minutes.
datasource:
  master: |-
    {
      driverClassName: "com.mysql.cj.jdbc.Driver"
      jdbcUrl: "jdbc:mysql://127.0.0.1:3306/oqsengine?useUnicode=true&serverTimezone=GMT&useSSL=false&characterEncoding=utf8&allowMultiQueries=true&rewriteBatchedStatements=true"
      username: "root",
      password: "root",
      maximumPoolSize: 3,
      maxLifetime: 25200000,
      connectionTimeout: 30000,
      validationTimeout: 10000
    }
  index:
    # Note that the url of the index must take the following parameters.
    # maxAllowedPacket=512000&useHostsInPrivileges=false&useLocalSessionState=true&serverTimezone=Asia/Shanghai
    write: |-
      {
        driverClassName: "com.mysql.cj.jdbc.Driver"
        jdbcUrl: "jdbc:mysql://127.0.0.1:9306/oqsengine?characterEncoding=utf8&&useHostsInPrivileges=false&useLocalSessionState=true&serverTimezone=Asia/Shanghai"
        username: "root",
        password: "root",
        maximumPoolSize: 3,
        maxLifetime: 600000,
        connectionTestQuery: "select 1",
        connectionTimeout: 30000,
        validationTimeout: 10000
      }
    search: |-
      {
        driverClassName: "com.mysql.cj.jdbc.Driver"
        jdbcUrl: "jdbc:mysql://127.0.0.1:9306/oqsengine?characterEncoding=utf8&useHostsInPrivileges=false&useLocalSessionState=true&serverTimezone=Asia/Shanghai"
        username: "root",
        password: "root",
        maximumPoolSize: 3,
        maxLifetime: 600000,
        connectionTestQuery: "select 1",
        connectionTimeout: 30000,
        validationTimeout: 10000
      }